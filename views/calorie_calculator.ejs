<%- include('partials/inner_header') %>

<div class="container">
    <div class="calculator-container">
        <h1 class="calculator-title"><%= title %></h1>
<%- include('partials/ad_unit') %>
        
        <div class="unit-switcher">
            <button id="metricBtn" class="unit-btn active">Metric (kg, cm)</button>
            <button id="imperialBtn" class="unit-btn">Imperial (lbs, ft, in)</button>
        </div>

        <div class="calculator-grid">
            <div class="form-section">
                <form id="calorieForm">
                    <div class="form-group">
                        <label>Gender</label>
                        <div class="gender-switcher">
                            <button type="button" id="genderMale" class="gender-btn active">Male</button>
                            <button type="button" id="genderFemale" class="gender-btn">Female</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="age">Age (years)</label>
                        <div class="input-wrapper"><input type="number" id="age" min="15" max="100" placeholder="e.g., 25"></div>
                    </div>
                    <div id="metricInputs">
                        <div class="form-group"><label for="weightKg">Weight (kg)</label><div class="input-wrapper"><input type="number" id="weightKg" step="0.1" placeholder="e.g., 70"></div></div>
                        <div class="form-group"><label for="heightCm">Height (cm)</label><div class="input-wrapper"><input type="number" id="heightCm" step="1" placeholder="e.g., 175"></div></div>
                    </div>
                    <div id="imperialInputs" style="display: none;">
                        <div class="form-group"><label for="weightLbs">Weight (lbs)</label><div class="input-wrapper"><input type="number" id="weightLbs" step="0.1" placeholder="e.g., 154"></div></div>
                        <div class="form-group"><label>Height (ft, in)</label><div class="height-imperial-inputs"><div class="input-wrapper"><input type="number" id="heightFt" placeholder="e.g., 5"><span class="input-adornment">ft</span></div><div class="input-wrapper"><input type="number" id="heightIn" placeholder="e.g., 9"><span class="input-adornment">in</span></div></div></div>
                    </div>
                    <div class="form-group">
                        <label for="activityLevel">Activity Level</label>
                        <div class="input-wrapper"><select id="activityLevel"><option value="1.2">Sedentary (little or no exercise)</option><option value="1.375">Lightly active (exercise 1-3 days/week)</option><option value="1.55">Moderately active (exercise 3-5 days/week)</option><option value="1.725">Very active (hard exercise 6-7 days/week)</option><option value="1.9">Extra active (very hard exercise & physical job)</option></select></div>
                    </div>
                </form>
            </div>
            
            <div class="result-section" id="result-section">
                <div class="placeholder">Enter your details to get a complete calorie plan for your weight goals.</div>
            </div>
        </div>

        <div class="faq-section">
            <div class="accordion-item"><button class="accordion-header"><span>What is a Calorie?</span><span class="icon">+</span></button><div class="accordion-content"><p>A calorie is a unit of energy. In nutrition, calories refer to the energy people get from the food and drink they consume, and the energy they use in physical activity. Calories are essential for human health; the key is consuming the right amount.</p></div></div>
            <div class="accordion-item"><button class="accordion-header"><span>How to Use These Results</span><span class="icon">+</span></button><div class="accordion-content"><p>The results show your estimated daily calorie needs to maintain your current weight, as well as goals for weight loss and gain. These numbers are a starting point. Adjust your intake based on your progress over a few weeks.</p></div></div>
            <div class="accordion-item"><button class="accordion-header"><span>Important Medical Disclaimer</span><span class="icon">+</span></button><div class="accordion-content"><p>This calculator provides an estimate and should not replace professional medical advice. For personalized nutrition and health guidance, please consult a qualified healthcare provider or a registered dietitian before making any significant changes to your diet or exercise routine.</p></div></div>
        </div>
<%- include('partials/ad_unit') %>
    </div>
</div>

<script>
    let currentUnit = 'metric', currentGender = 'male';
    const allInputs = document.querySelectorAll('input, select');
    const resultDiv = document.getElementById('result-section');
    const metricBtn = document.getElementById('metricBtn');
    const imperialBtn = document.getElementById('imperialBtn');
    const genderMaleBtn = document.getElementById('genderMale');
    const genderFemaleBtn = document.getElementById('genderFemale');
    const metricInputsDiv = document.getElementById('metricInputs');
    const imperialInputsDiv = document.getElementById('imperialInputs');

    function switchUnit(unit) {
        currentUnit = unit;
        metricBtn.classList.toggle('active', unit === 'metric');
        imperialBtn.classList.toggle('active', unit === 'imperial');
        metricInputsDiv.style.display = unit === 'metric' ? 'block' : 'none';
        imperialInputsDiv.style.display = unit === 'imperial' ? 'block' : 'none';
        allInputs.forEach(i => i.value = '');
        resultDiv.innerHTML = `<div class="placeholder">Enter your details to calculate.</div>`;
    }
    metricBtn.addEventListener('click', () => switchUnit('metric'));
    imperialBtn.addEventListener('click', () => switchUnit('imperial'));

    function switchGender(gender) {
        currentGender = gender;
        genderMaleBtn.classList.toggle('active', gender === 'male');
        genderFemaleBtn.classList.toggle('active', gender === 'female');
        calculateCalories();
    }
    genderMaleBtn.addEventListener('click', () => switchGender('male'));
    genderFemaleBtn.addEventListener('click', () => switchGender('female'));

    allInputs.forEach(input => input.addEventListener('input', calculateCalories));

    function calculateCalories() {
        let weightInKg, heightInCm;
        const age = parseFloat(document.getElementById('age').value);
        const activityMultiplier = parseFloat(document.getElementById('activityLevel').value);

        if (currentUnit === 'metric') {
            weightInKg = parseFloat(document.getElementById('weightKg').value);
            heightInCm = parseFloat(document.getElementById('heightCm').value);
        } else {
            const lbs = parseFloat(document.getElementById('weightLbs').value);
            const ft = parseFloat(document.getElementById('heightFt').value);
            const inches = parseFloat(document.getElementById('heightIn').value) || 0;
            if (!isNaN(lbs)) weightInKg = lbs * 0.453592;
            if (!isNaN(ft)) heightInCm = (ft * 12 + inches) * 2.54;
        }

        if (isNaN(weightInKg) || isNaN(heightInCm) || isNaN(age) || age < 15) {
            resultDiv.innerHTML = `<div class="placeholder">Please enter all valid details.</div>`;
            return;
        }

        const bmr = (currentGender === 'male') ? (10 * weightInKg) + (6.25 * heightInCm) - (5 * age) + 5 : (10 * weightInKg) + (6.25 * heightInCm) - (5 * age) - 161;
        const tdee = Math.round(bmr * activityMultiplier);
        const bmi = weightInKg / ((heightInCm / 100) ** 2);
        const bmiResult = bmi.toFixed(1);

        let category = '';
        if (bmi < 18.5) { category = 'Underweight'; } 
        else if (bmi >= 18.5 && bmi < 25) { category = 'Normal'; } 
        else { category = 'Overweight'; }
        
        const goals = {
            lose_mild: tdee - 250,
            lose_normal: tdee - 500,
            gain_mild: tdee + 250,
            gain_normal: tdee + 500,
            gain_fast: tdee + 1000,
        };

        resultDiv.innerHTML = `
            <div class="result-summary">
                <div class="bmi-info">BMI Score: <strong>${bmiResult} kg/m²</strong> (${category})</div>
                <div class="healthy-range">Healthy BMI Range: 18.5 - 25 kg/m²</div>
            </div>

            <div class="goals-container">
                <h4>Energy intake to lose weight:</h4>
                <div class="goal-card loss"><div class="goal-title">Mild weight loss<span>0.25 kg/week</span></div><div class="goal-calories">${goals.lose_mild.toLocaleString()}</div><div class="goal-details">Calories/day</div></div>
                <div class="goal-card loss"><div class="goal-title">Weight loss<span>0.5 kg/week</span></div><div class="goal-calories">${goals.lose_normal.toLocaleString()}</div><div class="goal-details">Calories/day</div></div>
                ${goals.lose_normal < 1500 ? `<div class="caution-box">Please consult a doctor for weight loss goals requiring less than 1,500 calories a day.</div>` : ''}
            </div>
            
            <div class="goals-container">
                <h4>Energy intake to gain weight:</h4>
                <div class="goal-card gain"><div class="goal-title">Mild weight gain<span>0.25 kg/week</span></div><div class="goal-calories">${goals.gain_mild.toLocaleString()}</div><div class="goal-details">Calories/day</div></div>
                <div class="goal-card gain"><div class="goal-title">Weight gain<span>0.5 kg/week</span></div><div class="goal-calories">${goals.gain_normal.toLocaleString()}</div><div class="goal-details">Calories/day</div></div>
                <div class="goal-card gain"><div class="goal-title">Fast weight gain<span>1 kg/week</span></div><div class="goal-calories">${goals.gain_fast.toLocaleString()}</div><div class="goal-details">Calories/day</div></div>
            </div>
        `;
    }
    
    document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', () => {
            const accordionItem = header.parentElement;
            accordionItem.classList.toggle('active');
            const content = header.nextElementSibling;
            content.style.maxHeight = accordionItem.classList.contains('active') ? content.scrollHeight + 'px' : '0px';
        });
    });
</script>

<%- include('partials/inner_footer') %>