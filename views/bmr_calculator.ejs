<%- include('partials/inner_header') %>

<div class="container">
    <div class="calculator-container">
        <h1 class="calculator-title"><%= title %></h1>
        
        <div class="unit-switcher">
            <button id="metricBtn" class="unit-btn active">Metric (kg, cm)</button>
            <button id="imperialBtn" class="unit-btn">Imperial (lbs, ft, in)</button>
        </div>

        <div class="calculator-grid">
            <div class="form-section">
                <form id="bmrForm">
                    <div class="form-group">
                        <label>Gender</label>
                        <div class="gender-switcher">
                            <button type="button" id="genderMale" class="gender-btn active">Male</button>
                            <button type="button" id="genderFemale" class="gender-btn">Female</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="age">Age (years)</label>
                        <div class="input-wrapper"><input type="number" id="age" min="15" max="100" placeholder="e.g., 25"></div>
                    </div>
                    <div id="metricInputs">
                        <div class="form-group"><label for="weightKg">Weight (kg)</label><div class="input-wrapper"><input type="number" id="weightKg" step="0.1" placeholder="e.g., 70"></div></div>
                        <div class="form-group"><label for="heightCm">Height (cm)</label><div class="input-wrapper"><input type="number" id="heightCm" step="1" placeholder="e.g., 175"></div></div>
                    </div>
                    <div id="imperialInputs" style="display: none;">
                        <div class="form-group"><label for="weightLbs">Weight (lbs)</label><div class="input-wrapper"><input type="number" id="weightLbs" step="0.1" placeholder="e.g., 154"></div></div>
                        <div class="form-group"><label>Height (ft, in)</label><div class="height-imperial-inputs"><div class="input-wrapper"><input type="number" id="heightFt" placeholder="e.g., 5"><span class="input-adornment">ft</span></div><div class="input-wrapper"><input type="number" id="heightIn" placeholder="e.g., 9"><span class="input-adornment">in</span></div></div></div>
                    </div>
                </form>
            </div>
            
            <div class="result-section" id="result-section">
                <div class="placeholder">
                    Enter your details to calculate your daily calorie needs at rest.
                </div>
            </div>
        </div>

        <div class="faq-section">
             <div class="accordion-item">
                <button class="accordion-header"><span>What is BMR?</span><span class="icon">+</span></button>
                <div class="accordion-content">
                    <p>Basal Metabolic Rate (BMR) is the total number of calories your body needs to perform basic, life-sustaining functions. These basal functions include circulation, breathing, cell production, nutrient processing, protein synthesis, and ion transport. Our BMR calculator uses the Mifflin-St Jeor equation, which is considered the most accurate formula.</p>
                </div>
            </div>
            <div class="accordion-item">
                <button class="accordion-header"><span>BMR vs. TDEE</span><span class="icon">+</span></button>
                <div class="accordion-content">
                    <p>Your BMR represents the calories you burn at complete rest. Total Daily Energy Expenditure (TDEE) is the total calories you burn in a day, including physical activity. TDEE is always higher than BMR. To calculate your TDEE, you would multiply your BMR by an activity factor (e.g., 1.2 for sedentary, 1.55 for moderately active).</p>
                </div>
            </div>
            <div class="accordion-item">
                <button class="accordion-header"><span>Factors Affecting BMR</span><span class="icon">+</span></button>
                <div class="accordion-content">
                    <p>Several factors influence your BMR, including:</p>
                    <ul>
                        <li><strong>Muscle Mass:</strong> More muscle increases BMR.</li>
                        <li><strong>Age:</strong> BMR tends to decrease with age.</li>
                        <li><strong>Genetics:</strong> Your genetic makeup plays a role.</li>
                        <li><strong>Diet:</strong> Severe calorie restriction can lower your BMR.</li>
                    </ul>
                </div>
            </div>
            <div class="accordion-item">
                <button class="accordion-header"><span>Important Medical Disclaimer</span><span class="icon">+</span></button>
                <div class="accordion-content">
                     <p>This BMR calculator is an informational tool only and should not be a substitute for professional medical advice. For a comprehensive assessment of your health and metabolic rate, please consult a qualified healthcare provider.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentUnit = 'metric', currentGender = 'male';
    const allInputs = document.querySelectorAll('input');
    const resultDiv = document.getElementById('result-section');
    const metricBtn = document.getElementById('metricBtn');
    const imperialBtn = document.getElementById('imperialBtn');
    const genderMaleBtn = document.getElementById('genderMale');
    const genderFemaleBtn = document.getElementById('genderFemale');
    const metricInputsDiv = document.getElementById('metricInputs');
    const imperialInputsDiv = document.getElementById('imperialInputs');

    function switchUnit(unit) {
        currentUnit = unit;
        metricBtn.classList.toggle('active', unit === 'metric');
        imperialBtn.classList.toggle('active', unit === 'imperial');
        metricInputsDiv.style.display = unit === 'metric' ? 'block' : 'none';
        imperialInputsDiv.style.display = unit === 'imperial' ? 'block' : 'none';
        allInputs.forEach(i => i.value = '');
        resultDiv.innerHTML = `<div class="placeholder">Enter your details to calculate.</div>`;
    }
    metricBtn.addEventListener('click', () => switchUnit('metric'));
    imperialBtn.addEventListener('click', () => switchUnit('imperial'));

    function switchGender(gender) {
        currentGender = gender;
        genderMaleBtn.classList.toggle('active', gender === 'male');
        genderFemaleBtn.classList.toggle('active', gender === 'female');
        calculateBMR();
    }
    genderMaleBtn.addEventListener('click', () => switchGender('male'));
    genderFemaleBtn.addEventListener('click', () => switchGender('female'));

    allInputs.forEach(input => input.addEventListener('input', calculateBMR));

    function calculateBMR() {
        let weightInKg, heightInCm;
        const age = parseFloat(document.getElementById('age').value);

        if (currentUnit === 'metric') {
            weightInKg = parseFloat(document.getElementById('weightKg').value);
            heightInCm = parseFloat(document.getElementById('heightCm').value);
        } else {
            const lbs = parseFloat(document.getElementById('weightLbs').value);
            const ft = parseFloat(document.getElementById('heightFt').value);
            const inches = parseFloat(document.getElementById('heightIn').value) || 0;
            if (!isNaN(lbs)) weightInKg = lbs * 0.453592;
            if (!isNaN(ft)) heightInCm = (ft * 12 + inches) * 2.54;
        }

        if (isNaN(weightInKg) || isNaN(heightInCm) || isNaN(age) || age < 15) {
            resultDiv.innerHTML = `<div class="placeholder">Please enter valid age, weight, and height.</div>`;
            return;
        }

        let bmr;
        if (currentGender === 'male') {
            bmr = (10 * weightInKg) + (6.25 * heightInCm) - (5 * age) + 5;
        } else {
            bmr = (10 * weightInKg) + (6.25 * heightInCm) - (5 * age) - 161;
        }
        
        const bmrResult = Math.round(bmr);

        const activityLevels = [
            { label: 'Sedentary: little or no exercise', multiplier: 1.2 },
            { label: 'Exercise 1-3 times/week', multiplier: 1.375 },
            { label: 'Exercise 4-5 times/week', multiplier: 1.465 },
            { label: 'Daily exercise or intense exercise 3-4 times/week', multiplier: 1.55 },
            { label: 'Intense exercise 6-7 times/week', multiplier: 1.725 },
            { label: 'Very intense exercise daily, or physical job', multiplier: 1.9 }
        ];

        const tableRows = activityLevels.map(level => {
            const calorieNeeds = Math.round(bmrResult * level.multiplier);
            return `<tr>
                        <td>${level.label}</td>
                        <td><strong>${calorieNeeds.toLocaleString()}</strong></td>
                    </tr>`;
        }).join('');

        resultDiv.innerHTML = `
            <div class="result-display-new">
                <p class="result-main-text">Your BMR: <strong>${bmrResult.toLocaleString()} kcal/day</strong></p>
                <hr class="result-divider" />
                <p class="result-sub-text">This is the number of calories you burn at complete rest.</p>
            </div>

            <div class="activity-table-container">
                <h4>Daily calorie needs based on activity level</h4>
                <table class="activity-table">
                    <thead>
                        <tr>
                            <th>Activity Level</th>
                            <th>Calorie</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
                <div class="activity-footnote">
                    <p><strong>Exercise:</strong> 15-30 minutes of elevated heart rate activity.</p>
                    <p><strong>Intense exercise:</strong> 45-120 minutes of elevated heart rate activity.</p>
                    <p><strong>Very intense exercise:</strong> 2+ hours of elevated heart rate activity.</p>
                </div>
            </div>
        `;
    }

    document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', () => {
            const accordionItem = header.parentElement;
            accordionItem.classList.toggle('active');
            const content = header.nextElementSibling;
            content.style.maxHeight = accordionItem.classList.contains('active') ? content.scrollHeight + 'px' : '0px';
        });
    });
</script>

<%- include('partials/inner_footer') %>